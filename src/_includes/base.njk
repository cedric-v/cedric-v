<!DOCTYPE html>
<html lang="{{ locale }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Eleventy">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://app.ontraport.com" crossorigin>
    <!-- Charger les fonts de manière asynchrone pour ne pas bloquer le rendu (économise ~760ms) -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>

    {% if title %}
    <title>{{ title }} | Fluance Pro</title>
    {% else %}
    {% if locale == 'fr' %}
    <title>Accueil | Fluance Pro</title>
    {% else %}
    <title>Home | Fluance Pro</title>
    {% endif %}
    {% endif %}
    <meta name="description" content="{{ description or 'Fluance Pro : accompagnement pour entrepreneurs et indépendants. Retrouvez fluidité, clarté stratégique et sérénité dans votre activité professionnelle.' }}">
    
    {# Découverte automatique des flux RSS - placé tôt dans le head pour une meilleure détection #}
    <link rel="alternate" type="application/rss+xml" title="Blog RSS - Fluance Pro (FR)" href="https://cedricv.com/feed.xml">
    <link rel="alternate" type="application/rss+xml" title="Blog RSS - Fluance Pro (EN)" href="https://cedricv.com/en/feed.xml">
    
    {# Liens pour IndieLogin et consolidation d'identité #}
    <link rel="me" href="https://github.com/cedric-v">
    <link rel="me" href="https://fluance.io">
    <link rel="me" href="https://fr.wikipedia.org/wiki/Utilisateur:Cédric">
    
    <!-- Styles critiques inline pour éviter le FOUC -->
    <style>
      /* Styles de base critiques */
      body {
        margin: 0;
        padding: 0;
        background-color: #fdfaf6;
        color: #1f1f1f;
        font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Header critique - styles minimaux pour éviter FOUC */
      #main-header,
      .site-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background-color: #0A6BCE;
        z-index: 50;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        overflow: visible;
      }
      
      .header-container {
        max-width: 72rem;
        margin-left: auto;
        margin-right: auto;
        padding-left: 1rem;
        padding-right: 1rem;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
      }
      
      #main-header img,
      .header-logo img {
        height: 3rem;
        width: auto;
        display: block;
      }
      
      .header-slogan {
        font-size: 0.75rem;
        color: rgba(255, 215, 0, 0.8);
        font-style: italic;
        margin-top: -0.25rem;
      }
      
      main,
      .page-main {
        padding-top: 7rem;
        min-height: 100vh;
      }
    </style>
    
    {% set originalUrl = (page.url or '/') | canonicalUrl %}
    {% set canonicalUrl = originalUrl %}
    {# Si on est sur la page racine / qui redirige vers /fr/, utiliser /fr/ comme canonical #}
    {# Toujours utiliser /fr/ comme canonical pour la page racine pour éviter les duplications #}
    {% if originalUrl == '/' or originalUrl == '/index.html' %}
      {% set canonicalUrl = '/fr/' %}
    {% endif %}
    <link rel="canonical" href="https://cedricv.com{{ canonicalUrl }}">
    
    {# Redirection meta refresh si spécifiée dans le frontmatter #}
    {% if page.redirectTo %}
      <meta http-equiv="refresh" content="0; url={{ page.redirectTo | relativeUrl }}">
    {% endif %}
    
    {# Open Graph / Facebook #}
    {% if locale == 'fr' %}
      {% set pageTitle = title or 'Accueil' %}
    {% else %}
      {% set pageTitle = title or 'Home' %}
    {% endif %}
    {% if locale == 'fr' %}
      {% set pageDescription = description or 'Fluance Pro : accompagnement pour entrepreneurs et indépendants. Retrouvez fluidité, clarté stratégique et sérénité dans votre activité professionnelle.' %}
    {% else %}
      {% set pageDescription = description or 'Fluance Pro: professional coaching for entrepreneurs and independents. Find clarity, strategic fluidity and serenity in your professional activity.' %}
    {% endif %}
    {% set pageUrl = 'https://cedricv.com' + canonicalUrl %}
    
    {# Détecter l'image : ogImage du frontmatter, ou image par défaut #}
    {# Pour utiliser l'image du hero automatiquement, ajoutez ogImage dans le frontmatter de chaque page #}
    {% set ogImagePath = ogImage or 'assets/img/fond-cedric.jpg' %}
    {% set ogImageUrl = ogImagePath | buildOgImageUrl %}
    
    {# Construire le titre OG : éviter la duplication de "Fluance Pro" #}
    {% set testTitle = pageTitle | replace("Fluance Pro", "") %}
    {% if testTitle != pageTitle %}
      {% set ogTitle = pageTitle %}
    {% else %}
      {% set ogTitle = pageTitle + " | Fluance Pro" %}
    {% endif %}
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ pageUrl }}">
    <meta property="og:title" content="{{ ogTitle }}">
    <meta property="og:description" content="{{ pageDescription }}">
    <meta property="og:image" content="{{ ogImageUrl }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:logo" content="https://cedricv.com/assets/img/new-logo-cedriv.png">
    {% if locale == 'fr' %}
    <meta property="og:locale" content="fr_FR">
    {% else %}
    <meta property="og:locale" content="en_US">
    {% endif %}
    {% if locale == 'fr' %}
    <meta property="og:locale:alternate" content="en_US">
    {% else %}
    <meta property="og:locale:alternate" content="fr_FR">
    {% endif %}
    <meta property="og:site_name" content="Fluance Pro">
    
    {# Twitter Card #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ pageUrl }}">
    <meta name="twitter:title" content="{{ ogTitle }}">
    <meta name="twitter:description" content="{{ pageDescription }}">
    <meta name="twitter:image" content="{{ ogImageUrl }}">
    
    {# Générer les balises hreflang correctement #}
    {% if locale == 'fr' %}
      {% if originalUrl == '/' %}
        {# Page racine qui redirige vers /fr/, utiliser /fr/ pour hreflang #}
        {% set frUrl = '/fr/' %}
        {% set enUrl = '/en/' %}
      {% elif canonicalUrl == '/fr/' %}
        {% set frUrl = '/fr/' %}
        {% set enUrl = '/en/' %}
      {% else %}
        {# Vérifier si c'est un article de blog avec une traduction définie #}
        {% if translation %}
          {% set frUrl = canonicalUrl %}
          {% set enUrl = translation %}
        {% elif canonicalUrl.startsWith('/en/') %}
          {# URL EN détectée, créer l'URL FR correspondante #}
          {% set frUrl = canonicalUrl | replace('/en/', '/fr/') %}
          {% set enUrl = canonicalUrl %}
        {% elif canonicalUrl.startsWith('/fr/') %}
          {# URL FR avec préfixe, remplacer par /en/ #}
          {% set frUrl = canonicalUrl %}
          {% set enUrl = canonicalUrl | replace('/fr/', '/en/') %}
        {% else %}
          {# Article de blog FR sans préfixe, ajouter /en/ pour la version EN #}
          {% set frUrl = canonicalUrl %}
          {% set enUrl = '/en' + canonicalUrl %}
        {% endif %}
      {% endif %}
    {% else %}
      {% if canonicalUrl == '/en/' %}
        {% set enUrl = '/en/' %}
        {% set frUrl = '/' %}
      {% else %}
        {# Vérifier si c'est un article de blog avec une traduction définie #}
        {% if translation %}
          {% set enUrl = canonicalUrl %}
          {% set frUrl = translation %}
        {% elif canonicalUrl.startsWith('/en/') %}
          {# URL EN avec préfixe, créer l'URL FR correspondante #}
          {% set enUrl = canonicalUrl %}
          {% set frUrl = canonicalUrl | replace('/en/', '/') %}
          {% if frUrl == '/fr/' %}
            {% set frUrl = '/' %}
          {% endif %}
        {% else %}
          {# Par défaut, garder les URLs telles quelles #}
          {% set enUrl = canonicalUrl %}
          {% set frUrl = canonicalUrl %}
        {% endif %}
      {% endif %}
    {% endif %}
    <link rel="alternate" hreflang="fr" href="https://cedricv.com{{ frUrl }}">
    <link rel="alternate" hreflang="en" href="https://cedricv.com{{ enUrl }}">
    
    <!-- Solution hybride pour le chargement CSS : Preload asynchrone + Fallback synchrone robuste -->
    <link rel="preload" href="{{ '/assets/css/styles.css' | relativeUrl }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ '/assets/css/styles.css' | relativeUrl }}"></noscript>
    <!-- Fallback synchrone robuste (100 ms) si le preload échoue -->
    <script>
      (function() {
        var link = document.querySelector('link[rel="preload"][as="style"]');
        if (link) {
          // Si le CSS n'est pas chargé après 100ms, le charger de manière synchrone
          setTimeout(function() {
            if (!link.sheet && link.rel !== 'stylesheet') {
              link.rel = 'stylesheet';
            }
          }, 100);
        }
      })();
    </script>
    
    <link rel="icon" type="image/x-icon" href="{{ '/favicon.ico' | relativeUrl }}">
    <link rel="icon" type="image/png" sizes="16x14" href="{{ '/assets/img/favicon-16x16.png' | relativeUrl }}">
    <link rel="icon" type="image/png" sizes="32x29" href="{{ '/assets/img/favicon-32x32.png' | relativeUrl }}">
    <link rel="shortcut icon" href="{{ '/favicon.ico' | relativeUrl }}">
    <link rel="apple-touch-icon" sizes="180x161" href="{{ '/assets/img/apple-touch-icon.png' | relativeUrl }}">
    
    <!-- Google Tag Manager - chargé uniquement après consentement -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      
      // Fonction pour charger GTM après consentement
      window.loadGTM = function() {
        // Vérifier si GTM n'est pas déjà chargé
        if (document.querySelector('script[src*="googletagmanager.com/gtm.js"]')) {
          return;
        }
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-FVTMPVN2');
      };
      
      // Charger GTM si le consentement a déjà été donné
      if (localStorage.getItem('cookieConsent') === 'accepted') {
        window.loadGTM();
      }
    </script>
    <!-- End Google Tag Manager -->
    
    {# Schema.org JSON-LD #}
    {% schemaOrg page, locale %}
</head>
<body class="page-body">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-FVTMPVN2"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    {% include "header.njk" %}

    <main class="page-main">
        {{ content | safe }}
    </main>
    
    {% include "footer.njk" %}

    <!-- Cookie Consent Banner -->
    <div id="cookie-banner" class="cookie-banner hidden">
      <div class="cookie-banner-container">
        <div class="cookie-banner-content">
          <div class="cookie-banner-text-section">
            <p class="cookie-banner-title">
              {% if locale == 'fr' %}Gestion des cookies{% else %}Cookie management{% endif %}
            </p>
            <p class="cookie-banner-description">
              {% if locale == 'fr' %}
              Nous utilisons des cookies pour améliorer votre expérience et analyser l'utilisation du site. En acceptant, vous autorisez l'utilisation de cookies analytiques (Google Analytics).
              {% else %}
              We use cookies to improve your experience and analyze site usage. By accepting, you authorize the use of analytical cookies (Google Analytics).
              {% endif %}
            </p>
            <a href="{{ '/mentions-legales/' | relativeUrl }}" class="cookie-banner-link">
              {% if locale == 'fr' %}En savoir plus{% else %}Learn more{% endif %}
            </a>
          </div>
          <div class="cookie-banner-actions">
            <div class="cookie-banner-button-group">
              <button id="accept-cookies" class="cookie-banner-button cookie-banner-button-accept">
                {% if locale == 'fr' %}Accepter{% else %}Accept{% endif %}
              </button>
              <button id="reject-cookies" class="cookie-banner-button cookie-banner-button-reject">
                {% if locale == 'fr' %}Refuser{% else %}Reject{% endif %}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

<script>
  const toggle = document.querySelector('[data-menu-toggle]');
  const mobileMenu = document.querySelector('[data-menu-mobile]');
  if (toggle && mobileMenu) {
    toggle.addEventListener('click', (e) => {
      e.stopPropagation();
      mobileMenu.classList.toggle('hidden');
    });
  }
  
  // Fermer le menu mobile quand on clique en dehors
  document.addEventListener('click', (e) => {
    if (mobileMenu && !mobileMenu.contains(e.target) && !toggle.contains(e.target)) {
      mobileMenu.classList.add('hidden');
    }
  });

  // Gestion des dropdowns mobiles
  document.querySelectorAll('[data-mobile-dropdown]').forEach(button => {
    button.addEventListener('click', () => {
      const dropdownId = button.getAttribute('data-mobile-dropdown');
      const content = document.querySelector(`[data-dropdown-content="${dropdownId}"]`);
      const arrow = document.querySelector(`[data-arrow="${dropdownId}"]`);
      
      if (content && arrow) {
        content.classList.toggle('hidden');
        arrow.classList.toggle('rotate-180');
      }
    });
  });

  // Effet de menu iOS au scroll (desktop uniquement)
  (function() {
    const header = document.getElementById('main-header');
    if (!header) return;
    
    const slogan = header.querySelector('.header-slogan');
    const isMobile = window.innerWidth < 768;
    
    let lastScrollY = window.scrollY;
    let ticking = false;
    
    function updateHeader() {
      const scrollY = window.scrollY;
      const isScrolled = scrollY > 50;
      
      if (isScrolled) {
        header.classList.add('header-scrolled');
        // Masquer le slogan avec JavaScript direct (pour Safari et tous les navigateurs)
        if (slogan) {
          slogan.style.display = 'none';
        }
      } else {
        header.classList.remove('header-scrolled');
        // Afficher le slogan
        if (slogan) {
          slogan.style.display = '';
        }
      }
      
      lastScrollY = scrollY;
      ticking = false;
    }
    
    function onScroll() {
      if (!ticking) {
        window.requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', function() {
      updateHeader();
    });
    
    // Initialiser au chargement
    updateHeader();
  })();

  // Gestion du consentement aux cookies
  (function() {
    const cookieBanner = document.getElementById('cookie-banner');
    const acceptBtn = document.getElementById('accept-cookies');
    const rejectBtn = document.getElementById('reject-cookies');
    
    // Vérifier si le consentement a déjà été donné
    const consent = localStorage.getItem('cookieConsent');
    
    if (consent) {
      // Cacher le bandeau si le consentement existe déjà
      cookieBanner.classList.add('hidden');
    } else {
      // Afficher le bandeau après un court délai pour une meilleure UX
      setTimeout(() => {
        cookieBanner.classList.remove('hidden');
        cookieBanner.classList.add('animate-slide-up');
      }, 500);
    }
    
    // Gérer l'acceptation
    acceptBtn.addEventListener('click', () => {
      localStorage.setItem('cookieConsent', 'accepted');
      cookieBanner.classList.add('hidden');
      
      // Charger GTM si pas déjà chargé
      if (!window.dataLayer || !window.dataLayer.find(e => e.event === 'gtm.js')) {
        if (typeof loadGTM === 'function') {
          loadGTM();
        }
      }
    });
    
    // Gérer le refus
    rejectBtn.addEventListener('click', () => {
      localStorage.setItem('cookieConsent', 'rejected');
      cookieBanner.classList.add('hidden');
    });
  })();


  // Amélioration de la navigation : préchargement et transition (optimisé pour les performances)
  (function() {
    // Précharger uniquement les liens du menu principal (pas tous les liens de la page)
    const menuNav = document.querySelector('nav[data-menu]');
    if (!menuNav) return;
    
    const menuLinks = menuNav.querySelectorAll('a[href^="/"], a[href^="/en/"], a[href^="/fr/"]');
    const prefetchedUrls = new Set();
    let prefetchTimeout = null;
    
    menuLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (!href || prefetchedUrls.has(href)) return;
      
      // Précharger au survol avec un léger délai pour éviter les prefetch inutiles
      link.addEventListener('mouseenter', () => {
        // Annuler le timeout précédent si l'utilisateur survole rapidement plusieurs liens
        if (prefetchTimeout) {
          clearTimeout(prefetchTimeout);
        }
        
        prefetchTimeout = setTimeout(() => {
          if (!prefetchedUrls.has(href)) {
            const linkElement = document.createElement('link');
            linkElement.rel = 'prefetch';
            linkElement.href = href;
            document.head.appendChild(linkElement);
            prefetchedUrls.add(href);
          }
        }, 100); // Délai de 100ms avant le prefetch
      }, { passive: true });
      
      // Transition douce lors du clic sur un lien interne
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        // Ne pas appliquer la transition pour les liens externes ou avec target="_blank"
        if (link.target === '_blank' || href.startsWith('http') || href.startsWith('javascript:')) {
          return;
        }
        
        // Ajouter une classe de transition très courte (utilise will-change pour optimisation)
        document.body.classList.add('page-transitioning');
        
        // Retirer la classe après un court délai (au cas où la navigation serait annulée)
        setTimeout(() => {
          document.body.classList.remove('page-transitioning');
        }, 100);
      }, { passive: true });
    });
  })();
</script>

<!-- Script de navigation header -->
<script src="{{ '/assets/js/header.js' | relativeUrl }}"></script>

<!-- Script de paiement Stripe -->
<script src="{{ '/assets/js/payment.js' | relativeUrl }}"></script>
</body>
</html>